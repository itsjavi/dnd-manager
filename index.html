<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>dnd-manager static harness</title>
    <style>
      :root {
        color-scheme: light;
      }

      body {
        margin: 0;
        padding: 24px;
        font-family:
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          sans-serif;
        background: #f8fafc;
        color: #0f172a;
      }

      h1 {
        margin: 0 0 8px;
      }

      #status {
        margin: 0 0 16px;
        font-size: 14px;
        color: #334155;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(2, 140px);
        gap: 10px;
        width: max-content;
      }

      .cell {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 92px;
        border-radius: 12px;
        color: white;
        font-weight: 700;
        user-select: none;
        touch-action: none;
        cursor: grab;
        transition:
          transform 0.15s,
          opacity 0.15s,
          box-shadow 0.15s;
      }

      .cell[data-dragging='true'] {
        opacity: 0.45;
        cursor: grabbing;
      }

      .cell[data-hovered='true'] {
        transform: scale(1.04);
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.45);
      }

      #drag-preview {
        position: fixed;
        pointer-events: none;
        z-index: 9999;
        transform: translate(-50%, -50%);
        padding: 10px 14px;
        border-radius: 999px;
        color: white;
        font-weight: 700;
        box-shadow: 0 8px 24px rgba(15, 23, 42, 0.3);
        opacity: 0.92;
      }
    </style>
  </head>
  <body>
    <h1>dnd-manager static harness</h1>
    <p id="status" data-testid="status">Loading...</p>
    <div id="grid" class="grid" data-testid="grid">
      <div
        class="cell"
        data-testid="cell-a"
        data-kind="cell"
        data-id="a"
        data-label="Alpha"
        style="background: #ef4444"
      >
        Alpha
      </div>
      <div
        class="cell"
        data-testid="cell-b"
        data-kind="cell"
        data-id="b"
        data-label="Beta"
        style="background: #2563eb"
      >
        Beta
      </div>
    </div>
    <div id="drag-preview" hidden data-testid="drag-preview"></div>

    <script type="module">
      import { DragDropManager } from './dist/index.mjs'

      const status = document.getElementById('status')
      const grid = document.getElementById('grid')
      const preview = document.getElementById('drag-preview')
      const hasExport = typeof DragDropManager === 'function'

      const getCellColor = (id) => (id === 'a' ? '#ef4444' : '#2563eb')

      const updateCellVisual = (cell, item) => {
        cell.dataset.id = item.id
        cell.dataset.label = item.label
        cell.textContent = item.label
        cell.style.background = getCellColor(item.id)
      }

      if (status) {
        status.textContent = hasExport ? 'Library loaded from dist.' : 'Library failed to load.'
      }

      if (!hasExport || !grid || !preview || !status) {
        window.__dndHarnessLoaded = false
      } else {
        const callbacks = {
          onDragStart: (element, position, item) => {
            preview.hidden = false
            preview.textContent = item.label
            preview.style.background = getCellColor(item.id)
            status.textContent = `Dragging ${item.label}`
          },
          onDragMove: (pos) => {
            preview.style.left = `${pos.x}px`
            preview.style.top = `${pos.y}px`
          },
          onDrop: (sourcePosition, targetPosition, sourceItem) => {
            const sourceCell = grid.querySelector(`[data-id="${sourcePosition}"]`)
            const targetCell = grid.querySelector(`[data-id="${targetPosition}"]`)
            if (!sourceCell || !targetCell) return

            const targetItem = {
              id: targetCell.dataset.id,
              label: targetCell.dataset.label,
            }

            updateCellVisual(targetCell, sourceItem)
            updateCellVisual(sourceCell, targetItem)
            status.textContent = `Dropped ${sourceItem.label} on ${targetPosition.toUpperCase()}`
          },
          onDragEnd: () => {
            preview.hidden = true
            status.textContent = 'Ready'
          },
          onClick: (element) => {
            status.textContent = `Clicked ${element.dataset.label}`
          },
          getItemData: (element) => ({
            id: element.dataset.id,
            label: element.dataset.label,
          }),
          getItemPosition: (element) => element.dataset.id ?? null,
        }

        window.__dndHarnessManager = new DragDropManager(
          grid,
          {
            draggableKind: 'cell',
            droppableKind: 'cell',
            dragThreshold: 4,
            clickThreshold: 8,
          },
          callbacks,
        )
        window.__dndHarnessLoaded = true
      }
    </script>
  </body>
</html>
